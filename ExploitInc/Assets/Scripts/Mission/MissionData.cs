using System;
using UnityEngine;

namespace SBaier.ExploitInc
{
	public class MissionData
	{
		private MissionState _state = MissionState.Preparation;
		public event Action OnMissionStateChanged;
		public MissionState State
		{
			get => _state;
			set
			{
				_state = value;
				OnMissionStateChanged?.Invoke();
			}
		}

		private double _earnedMoney = 0;
		public event Action OnEarnedMoneyChanged;
		public double EarnedMoney
		{
			get => _earnedMoney;
			private set
			{
				_earnedMoney = value;
				OnEarnedMoneyChanged?.Invoke();
			}
		}

		private double _currentMoney;
		public event Action<double> OnCurrentMoneyChanged;
		public double CurrentMoney
		{
			get => _currentMoney;
			private set
			{
				double delta = value - _currentMoney;
				_currentMoney = value;
				OnCurrentMoneyChanged?.Invoke(delta);
			}
		}

		public float MissionStartTime { get; }
		public float OnGoingStartTime { get; set; } = 0;
		public float TimeSinceMissionStart => Time.time - OnGoingStartTime;

		public MissionData(float missionStartTime,
			double startMoney)
		{
			MissionStartTime = missionStartTime;
			CurrentMoney = startMoney;
		}



		public void AddEarnedMoney(double amount)
		{
			CurrentMoney += amount;
			EarnedMoney += amount;
		}

		/// <summary>
		/// Requesting money is only possible if there currently is enough money.
		/// </summary>
		/// <param name="amount"></param>
		public void RequestMoney(double amount)
		{
			if (amount < 0 || amount > CurrentMoney)
				throw new ArgumentException("You can not request more money than you currently have.");

			CurrentMoney -= amount;
		}

		/// <summary>
		/// Reducing money is possible even if there currently is not enough money.
		/// May cause failure of the mission task
		/// </summary>
		/// <param name="amount"></param>
		public void ReduceMoney(double amount)
		{
			if (amount < 0)
				throw new ArgumentException();
			CurrentMoney -= amount;
		}
	}
}