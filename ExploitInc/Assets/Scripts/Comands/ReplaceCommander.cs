
namespace SBaier.ExploitInc
{
	public abstract class ReplaceCommander<TCommandsContainer> : Commander<TCommandsContainer> where TCommandsContainer : CommandsContainer
	{
		

		protected internal override void addCommand(Command command)
		{
			if(_container.CurrentCommand != null)
				_container.CurrentCommand.State = CommandState.Canceled;
			_container.CurrentCommand = command;
			_container.CurrentCommand.OnStateChanged += onStateChange;
		}

		protected internal override void removeCommand(Command command)
		{
			_container.CurrentCommand.State = CommandState.Canceled;
		}

		private void onStateChange(Command.StateChangeArgs args)
		{
			switch(args.NewState)
			{
				case CommandState.Canceled:
				case CommandState.Finished:
					args.Command.OnStateChanged -= onStateChange;
					_container.CurrentCommand = null;
					break;
			}
		}
	}
}