using System.Collections;
using System.Collections.Generic;
using UnityEngine;

namespace SBaier.ExploitInc
{
	[RequireComponent(typeof(Collider))]
	public abstract class PositiveHighlighter : MonoBehaviour
	{
		[SerializeField]
		private bool _highlightOnStart = false;

		private List<PositiveHighlightable> _highlightables = new List<PositiveHighlightable>();

		private bool _doHighlight = false;
		public bool DoHighlight
		{
			get => _doHighlight;
			set
			{
				_doHighlight = value;
				checkEnableHighlighing();
			}
		}

		protected virtual void Awake()
		{
			DoHighlight = _highlightOnStart;
		}

		protected virtual void OnDestroy()
		{
			foreach (PositiveHighlightable highlightable in _highlightables)
				highlightable.Highlight(false);
		}

		protected virtual void OnTriggerEnter(Collider other)
		{
			PositiveHighlightable highlightable = other.GetComponentInChildren<PositiveHighlightable>();
			if (highlightable == null || _highlightables.Contains(highlightable))
				return;
			bool highlight = checkHighlight(highlightable);
			if (!highlight)
				return;
			_highlightables.Add(highlightable);
			if(DoHighlight)
				highlightable.Highlight(highlight);
		}

		protected virtual void OnTriggerExit(Collider other)
		{
			PositiveHighlightable highlightable = other.GetComponentInChildren<PositiveHighlightable>();
			if (highlightable == null || !_highlightables.Contains(highlightable))
				return;
			if (DoHighlight)
				highlightable.Highlight(false);
			_highlightables.Remove(highlightable);
		}
		private void checkEnableHighlighing()
		{
			foreach (PositiveHighlightable highlightable in _highlightables)
				highlightable.Highlight(DoHighlight);
		}

		protected abstract bool checkHighlight(PositiveHighlightable highlightable);

	}
}