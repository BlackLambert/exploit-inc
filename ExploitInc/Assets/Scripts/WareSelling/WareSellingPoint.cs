using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using Zenject;

namespace SBaier.ExploitInc
{
	public class WareSellingPoint : MonoBehaviour
	{
		[SerializeField]
		private DeliveryContainer _deliveryContainer;
		public DeliveryContainer DeliveryContainer => _deliveryContainer;

		private MissionData _missionData;


		[Inject]
		private void Construct(MissionData missionData)
		{
			_missionData = missionData;
		}


		protected virtual void Start()
		{
			_deliveryContainer.OnStoredChanged += onStoredChanged;
		}

		protected virtual void OnDestroy()
		{
			_deliveryContainer.OnStoredChanged -= onStoredChanged;
		}




		private void onStoredChanged()
		{
			foreach(Deliverable deliverable in _deliveryContainer.AvailableDeliverablesCopy)
			{
				if (!(deliverable is DeliverableWare))
					throw new ArgumentException();
				_deliveryContainer.Reserve(deliverable);
				_deliveryContainer.Take(deliverable);
				sell(deliverable as DeliverableWare);
			}
		}

		private void sell(DeliverableWare deliverableWare)
		{
			_missionData.AddEarnedMoney(deliverableWare.Ware.Config.CreditsForSelling);
			Destroy(deliverableWare.Base.gameObject);
		}
	}
}