
using System.Collections;
using UnityEngine;
using Zenject;

namespace SBaier.ExploitInc
{
	public class RouteShower : MonoBehaviour
	{
		[SerializeField]
		private LineRenderer _renderer = null;
		[Range(0f,1f)]
		[SerializeField]
		private float _showTime = 0.33f;
		[Range(0f, 1f)]
		[SerializeField]
		private float _hideTime = 0.25f;
		[SerializeField]
		private CanvasGroup _canvasGroup = null;
		[SerializeField]
		private PinToPosition _uiPin = null;

		private Coroutine _routine;


		protected virtual void Update()
		{
			if(_renderer.positionCount > 1)
				_uiPin.TargetPos = _renderer.GetPosition(_renderer.positionCount / 2);
		}

		public void Show(bool show)
		{
			if (_routine != null)
				StopCoroutine(_routine);
			
			if (show)
				_routine = StartCoroutine(doShow());
			else
				_routine = StartCoroutine(doHide());
		}

		private IEnumerator doShow()
		{
			_renderer.gameObject.SetActive(true);
			while (_renderer.material.color.a < 1)
			{
				float value = Time.deltaTime / _showTime;
				setColor(value);
				setUIAlpha(value);
				yield return 0;
			}
			_canvasGroup.interactable = true;
			_canvasGroup.blocksRaycasts = true;

		}

		private IEnumerator doHide()
		{
			while (_renderer.material.color.a > 0)
			{
				float value = (Time.deltaTime / _hideTime) * (-1);
				setColor(value);
				setUIAlpha(value);
				yield return 0;
			}
			_renderer.gameObject.SetActive(false);
			_canvasGroup.interactable = false;
			_canvasGroup.blocksRaycasts = false;
		}

		private void setUIAlpha(float delta)
		{
			_canvasGroup.alpha = Mathf.Clamp01(_canvasGroup.alpha + delta);
		}

		private void setColor(float delta)
		{
			Color col = _renderer.material.color;
			_renderer.material.color = new Color(col.r, col.g, col.b, Mathf.Clamp01(col.a + delta));
		}
	}
}