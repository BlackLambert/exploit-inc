using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

namespace SBaier.ExploitInc
{
	public class VerticalMover : MonoBehaviour
	{
		[SerializeField]
		private Transform _movableObject = null;

		private float _delta = 0;
		private float _currentTime = 0;
		private float _duration = 0;
		private Vector3 _formerPosition;

		public Action OnMovementFinished;

		public void Cancel()
		{
			_currentTime = _duration;
			_movableObject.localPosition = _formerPosition;
		}

		public void MoveBy(float delta, float duration = 0)
		{
			initMovement();
			_delta = delta;
			_duration = duration;
		}

		public void MoveTo(float targetHeight, float duration = 0)
		{
			initMovement();
			_delta = calculateDelta(targetHeight);
			_duration = duration;
		}

		private float calculateDelta(float targetHeight)
		{
			return targetHeight - _formerPosition.y;
		}

		private void initMovement()
		{
			_formerPosition = _movableObject.localPosition;
			_currentTime = 0;
		}

		protected virtual void Start()
		{
			_formerPosition = _movableObject.localPosition;
		}

		protected virtual void Update()
		{
			if (_currentTime <= _duration)
				move();
		}

		private void move()
		{
			_currentTime += Time.deltaTime;
			if (_duration <= 0)
				_movableObject.localPosition = _formerPosition + Vector3.up * _delta;
			else
				_movableObject.localPosition = Vector3.Lerp(_formerPosition, _formerPosition + Vector3.up * _delta, _currentTime / _duration);
			if (_currentTime > _duration)
				OnMovementFinished?.Invoke();
		}
	}
}